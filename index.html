<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–û–ù–ò–¢–û–†–ò–ù–ì –ü–û–°–¢–ê–í–û–ö</title>
    <style>
        :root {
            --bg-color: #050505;
            --card-bg: #121212;
            --accent: #00a2ff;
            --success: #00ff6a;
            --text: #ffffff;
        }
        body { background: var(--bg-color); color: var(--text); font-family: sans-serif; padding: 20px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .card { 
            background: var(--card-bg); 
            padding: 20px; 
            border-radius: 10px; 
            border-left: 4px solid #333; 
            opacity: 0.5; 
            transition: 0.3s;
        }
        .card.active { opacity: 1; border-left-color: var(--success); background: #0a1a0f; }
        .settings-btn { position: fixed; bottom: 20px; right: 20px; background: #333; border: none; color: #fff; padding: 10px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h1>–õ–û–ì–ò–°–¢–ò–ö–ê</h1>
    <div id="stats">–ù–∞ –º–µ—Å—Ç–µ: <span id="done-count" style="color:var(--success)">0</span></div>
</div>

<div class="grid" id="main-grid"></div>

<button class="settings-btn" onclick="editList()">‚öôÔ∏è</button>

<script>
    // ID —Ç–≤–æ–µ–π —Ç–∞–±–ª–∏—Ü—ã
    const SHEET_ID = '1TRfjAtckFpCuLTAwutozcN71TbpE4QHGNbG2s4W9dPKdvaya5XCHzxPEFBSTIU9EXHeTuoj4gRNAiB';
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –ø—É—Ç—å –∫ tq (Table Query)
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∏–∑ –ø–∞–º—è—Ç–∏ –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫
    let providers = JSON.parse(localStorage.getItem('savedProviders')) || ["–ü—Ä–æ–≤–∞–π–¥–µ—Ä 1", "–ü—Ä–æ–≤–∞–π–¥–µ—Ä 2"];

    function editList() {
        const res = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º–µ–Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:", providers.join(", "));
        if (res) {
            providers = res.split(",").map(s => s.trim());
            localStorage.setItem('savedProviders', JSON.stringify(providers));
            render([]); 
            loadData();
        }
    }

    async function loadData() {
        try {
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä t –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞
            const response = await fetch(`${URL}&t=${Date.now()}`);
            if (!response.ok) throw new Error('Network response was not ok');
            
            const text = await response.text();
            
            // Google –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: /* google.visualization.Query.setResponse({...}); */
            // –ù–∞–º –Ω—É–∂–Ω–æ –≤—ã—Ä–µ–∑–∞—Ç—å –≤—Å—ë –ª–∏—à–Ω–µ–µ
            const start = text.indexOf('{');
            const end = text.lastIndexOf('}');
            if (start === -1 || end === -1) throw new Error('Invalid JSON format from Google');
            
            const jsonString = text.substring(start, end + 1);
            const json = JSON.parse(jsonString);
            
            if (json.status === 'error') {
                console.error("Google API Error:", json.errors);
                return;
            }

            render(json.table.rows);
        } catch (e) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", e.message);
            // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø—É—Å—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
            render([]);
        }
    }

    function render(rows) {
        const grid = document.getElementById('main-grid');
        let done = 0;
        
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–º–µ–Ω –∏–∑ —Ç–∞–±–ª–∏—Ü—ã (–æ–±—ã—á–Ω–æ –∏–º—è –≤–æ –≤—Ç–æ—Ä–æ–º —Å—Ç–æ–ª–±—Ü–µ - –∏–Ω–¥–µ–∫—Å 1)
        const registeredNames = rows.map(r => {
            if (r && r.c && r.c[1]) {
                return r.c[1].v ? String(r.c[1].v).trim() : null;
            }
            return null;
        }).filter(Boolean);

        grid.innerHTML = providers.map(name => {
            const isHere = registeredNames.includes(name);
            if (isHere) done++;
            return `
                <div class="card ${isHere ? 'active' : ''}">
                    <div style="font-size: 12px; color: #888;">${isHere ? '‚úÖ –ü–†–ò–ë–´–õ' : 'üïí –í –ü–£–¢–ò'}</div>
                    <div style="font-size: 18px; font-weight: bold; margin-top: 5px;">${name}</div>
                </div>
            `;
        }).join('');

        document.getElementById('done-count').innerText = done;
    }

    // –û–ø—Ä–æ—Å —Ç–∞–±–ª–∏—Ü—ã –∫–∞–∂–¥—ã–µ 7 —Å–µ–∫—É–Ω–¥ (—á—É—Ç—å —Ä–µ–∂–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
    setInterval(loadData, 7000);
    loadData();
</script>

</body>
</html>
